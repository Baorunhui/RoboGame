#include "usart.h"
#include"./motor/motor_control.h"

uint8_t USART2_RX_BUF[USART2_REC_LEN];//????,??USART_REC_LEN???.
uint16_t USART2_RX_STA=0;//??????//bit15:??????,bit14~0:??????????
uint8_t USART2_NewData;//?????????1????????


void  HAL_UART_RxCpltCallback(UART_HandleTypeDef  *huart)//????????
{
	
    if(huart ==&huart2)
    {
			HAL_GPIO_TogglePin(GPIOB, LED0_Pin);
//			HAL_GPIO_WritePin(GPIOB, LED0_Pin,GPIO_PIN_RESET);
        if((USART2_RX_STA&0x8000)==0)//?????
        {
//					HAL_GPIO_TogglePin(GPIOE, LED1_Pin);
            if(USART2_NewData==0x5A)//????0x5A
            {
                 USART2_RX_STA|=0x8000;   //?????,?USART2_RX_STA??bit15(15?)?1
            }
            else
            {
                   USART2_RX_BUF[USART2_RX_STA&0X7FFF]=USART2_NewData; /*??????????,
                   ??????1(??):
                   USART2_RX_BUF[0]=0xA5
                   USART2_RX_BUF[1]=0x01
                   USART2_RX_BUF[2]=0x01
                   ?????????????4???????0x5A???
    	           ?USART2_RX_BUF?,??????????0x5A???USART2_RX_STA?????1*/
                   USART2_RX_STA++;  //???????1
                   if(USART2_RX_STA>(USART2_REC_LEN-1))
										 USART2_RX_STA=0;//??????,??????

            }
        }
        HAL_UART_Receive_IT(&huart2,(uint8_t *)&USART2_NewData,1); //????????????????????????,?????????????


    }
}
